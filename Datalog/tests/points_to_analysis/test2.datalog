.basedir "test_out"

## Domains
BC 255
Variable 26 variables.map
Object 35 objects.map
Field 10 fields.map
Type 27 types.map
Selector 3 selectors.map
Method 78 methods.map
ParamPosition 255
	
.include "./test_points_to_analysis.relations"
.include "./dummies.relations"
.include "../../points_to_analysis.rules"

roots("A.m1()").

# simple call/return
# C<:-D
# A.m1() { B b = new B(); C c = b.m2(); }
# B.m2() { D d = constant 1; return d; }

assignable("A", "A").
assignable("B", "B").
assignable("C", "C").
assignable("C", "D").
assignable("D", "D").

variableType("A.m1()", "b", "B").
variableType("A.m1()", "c", "C").
variableType("B.m2()", "d", "D").

objectType("new B()", "B").
objectType("constant 1", "D").
member("B", "m2()", "B.m2()").

new("A.m1()", "b", "new B()").
virtualInvoke("A.m1()", 1, "m2()").
actual("A.m1()", 1, 0, "b").
callSiteReturn("A.m1()", 1, "c").

constant("B.m2()", "d", "constant 1").
methodReturn("B.m2()", "d").

roots("A.m1()").

#assertions
ERR 256
error2(num:ERR) outputtuples

error2(0) :- !executionContext(0, 0, 0, 0, "A.m1()").
error2(1) :- !executionContext(0, 0, 0, "new B()", "B.m2()").
error2(2) :- !invocationEdge(0, 0, 0, 0, "A.m1()", 1, 0, 0, 0, "new B()", "B.m2()").
error2(3) :- !variablePT(0, 0, 0, 0, "A.m1()", "c", 0, "constant 1").